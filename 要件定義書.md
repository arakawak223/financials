# 財務分析アプリケーション 要件定義書

**作成日**: 2025年10月5日
**完成目標**: 2025年10月末

---

## 1. システム概要

### 1.1 目的
取引先企業の経営状態を客観的に分析し、クライアント経営者やメインバンクへの報告資料を作成する。

### 1.2 ターゲットユーザー
- 公認会計士
- 中小企業診断士
- その他財務分析の専門家

### 1.3 利用シーン
- クライアント経営者への客観的な経営分析の提供
- メインバンクからの依頼による融資先企業の調査・分析

### 1.4 利用形態
- 1〜5名程度のチームでの共同利用
- チームメンバー全員がすべてのデータにアクセス可能
- クラウドベースでどこからでもアクセス可能
- PC、スマートフォン、タブレット対応（レスポンシブデザイン）

---

## 2. 機能要件

### 2.1 MVP（最小実用版）の範囲

**Phase 1（MVP）**: 以下3機能を10月末までに実装
- A. PDF読み込み機能
- B. 財務指標の計算と表示機能
- C. Excel・PowerPoint出力機能

**Phase 2（将来対応）**:
- D. 複数企業の管理機能（業種・グループ・企業の階層管理）
- E. タグ・ラベル機能

---

## 3. 詳細機能要件

### 3.1 PDF読み込み機能（Priority: A - 最優先）

#### 3.1.1 入力データ
1社あたり、以下の6つのPDFファイルをアップロード：
- 決算書（BS・PLを含む）× 3期分
- 勘定科目内訳書 × 3期分

#### 3.1.2 対応するPDFフォーマット
**決算書:**
- デジタルPDF（会計ソフトから直接出力）
- スキャンPDF（紙の決算書をスキャンしたもの）※OCR処理が必要

**優先対応する会計ソフト:**
1. 弥生会計
2. 勘定奉行
3. JDL

**将来対応:**
- freee
- マネーフォワード

**勘定科目内訳書:**
- 国税庁の標準フォーマット（法人税申告書の別表ではなく、勘定科目内訳書）

#### 3.1.3 データ読み取り・修正機能
- PDFから自動でデータを抽出
- 読み取りエラーが発生した場合は、利用者（専門家）に通知
- Excel形式の表で表示し、利用者が直接編集可能
  - 表の構造：縦軸に勘定科目、横軸に期（年度）
- 元のPDFを画面表示する必要はなし

#### 3.1.4 対象勘定科目
以下の勘定科目を含む（一部抜粋）：

**資産:**
- 現金預金
- 有価証券
- 受取手形
- 売掛金
- 棚卸資産
- 貸付金
- 未収入金
- 仮払金
- 土地

**負債:**
- 借入金
- 支払手形
- 買掛金
- 未払金
- 未払費用

**費用:**
- 役員報酬
- 地代家賃

---

### 3.2 財務指標の計算と表示機能（Priority: B）

#### 3.2.1 分析対象期間
- 直近3期

#### 3.2.2 手入力項目
利用者が以下の項目を手入力で追加：
- 減価償却費（3期分）
- 設備投資額（3期分）

#### 3.2.3 計算する財務指標

**1. 流動性・安全性指標**
- NetCash / NetDebt（純現金預金残高 / 純有利子負債残高）
  - 計算式：現金預金 - 有利子負債（借入金・社債・リース債務）
  - 表示：直近3期末それぞれの値

**2. 効率性指標**
- 売掛金滞留月数（直近3期末それぞれ）
- 棚卸資産滞留月数（直近3期末それぞれ）

**3. 収益性指標**
- EBITDA
  - 計算式：営業利益 + 減価償却費
  - 表示：直近3期それぞれ
- FCF（フリーキャッシュフロー）
  - 計算式：EBITDA - 設備投資額
  - 表示：直近3期それぞれ
- 売上高成長率
  - 各年度の前期比率
  - 3年間の平均成長率
- 売上総利益率（直近3期それぞれ）
- 営業利益率（直近3期それぞれ）
- EBITDA対売上高比率（直近3期それぞれ）

**4. 財務健全性指標**
- EBITDA対有利子負債比率
  - 計算式：（期首有利子負債 + 期末有利子負債）÷ 2 ÷ EBITDA
  - 表示：直近3期それぞれ
- 流動比率（直近3期それぞれ）

**5. 資本効率指標**
- ROE（自己資本利益率）（直近3期それぞれ）
- ROA（総資産利益率）（直近3期それぞれ）

#### 3.2.4 グラフ表示
- 上記すべての指標について、3期分の推移グラフを自動生成

#### 3.2.5 勘定科目別推移表
- 対象勘定科目：3.1.4記載の勘定科目
- 表示内容：
  - 3期分の残高/金額
  - 直近期と前期の増減金額

---

### 3.3 Excel・PowerPoint出力機能（Priority: C）

#### 3.3.1 Excel出力
以下の4シートを含むExcelファイルを生成：

1. **勘定科目別推移表**
   - 3期分の勘定科目ごとの残高/金額
   - 増減金額

2. **財務指標一覧**
   - 3.2.3で計算したすべての財務指標
   - 3期分の数値

3. **生データ（BS・PL）**
   - PDFから読み取った原データ

4. **グラフ**
   - 各財務指標の推移グラフ

#### 3.3.2 PowerPoint出力
以下の4種類のスライドを含むPowerPointファイルを生成：

1. **財務指標の一覧表**
   - 主要指標を表形式で整理

2. **グラフ（各指標の推移）**
   - 各財務指標の3期推移グラフ

3. **勘定科目別の推移表**
   - 重要勘定科目の推移

4. **総合的な分析コメント**
   - AIによる自動生成
   - 利用者（専門家）による編集が可能
   - 例：「流動比率が低下しており、短期的な支払い能力に注意が必要です」

---

### 3.4 複数企業の管理機能（Priority: D - Phase 2）

#### 3.4.1 階層構造
以下の3階層で企業データを管理：
1. 業種別
2. 企業グループ別
3. 企業別

#### 3.4.2 記録情報
- 企業名
- 分析実施日
- 業種
- 企業グループ

#### 3.4.3 将来機能
- タグ・ラベル機能（自由なカテゴリ分類）

---

## 4. 非機能要件

### 4.1 セキュリティ

#### 4.1.1 認証・認可
- ログイン認証必須
- 企業データまたは企業グループごとにパスワード保護
- チームメンバー全員が全データにアクセス可能

#### 4.1.2 データ保護
- アクセス履歴の記録
- クラウド上に安全に保存

### 4.2 パフォーマンス
- PDF読み込み：1ファイルあたり30秒以内
- 財務指標計算：リアルタイム（数秒以内）
- Excel/PowerPoint出力：30秒以内

### 4.3 対応デバイス・ブラウザ
- PC（Windows、Mac）：Chrome、Edge、Safari最新版
- スマートフォン・タブレット：iOS Safari、Android Chrome
- レスポンシブデザイン対応

### 4.4 データ保存
- クラウドベース（Supabaseを想定）
- どこからでもアクセス可能

---

## 5. 技術スタック（想定）

### 5.1 フロントエンド
- Next.js（既存環境）
- TypeScript
- Tailwind CSS
- shadcn/ui

### 5.2 バックエンド
- Next.js API Routes / Server Actions
- Supabase（認証・データベース）

### 5.3 PDF処理
- PDF.js（デジタルPDF読み取り）
- OCR API（スキャンPDF読み取り）：Google Cloud Vision API / Tesseract.js / AWS Textract など

### 5.4 AI機能
- OpenAI API / Claude API（分析コメント自動生成）

### 5.5 ファイル生成
- ExcelJS（Excel出力）
- pptxgenjs（PowerPoint出力）

---

## 6. プロジェクト計画

### 6.1 スケジュール
- **完成目標**: 2025年10月末
- **期間**: 約25日間

### 6.2 開発フェーズ

**Week 1（10/5 - 10/11）**
- 環境構築
- PDF読み込み機能の実装（基本）
- データ表示・編集UI

**Week 2（10/12 - 10/18）**
- PDF読み込み機能の完成（OCR対応）
- 財務指標計算ロジックの実装
- グラフ表示機能

**Week 3（10/19 - 10/25）**
- Excel出力機能
- PowerPoint出力機能
- AI分析コメント生成

**Week 4（10/26 - 10/31）**
- セキュリティ機能（認証・パスワード保護）
- テスト・バグ修正
- 最終調整

---

## 7. 成功基準

### 7.1 MVP完成の定義
以下がすべて動作すること：
1. 6つのPDFファイル（決算書3期分、勘定科目内訳書3期分）を読み込める
2. 読み込んだデータをExcel形式の表で確認・修正できる
3. すべての財務指標が正しく計算され、グラフ表示される
4. ExcelファイルとPowerPointファイルが自動生成される
5. ログイン認証とデータ保護が機能する

### 7.2 品質基準
- 計算精度：財務指標の計算が100%正確
- ユーザビリティ：専門家が直感的に操作できる
- エラーハンドリング：読み取りエラー時に適切に通知・修正可能

---

## 8. リスクと対策

### 8.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| OCRの精度が低い | 高 | 手動修正機能を充実させる / 複数OCR APIの併用検討 |
| 会計ソフトのフォーマット多様性 | 高 | まず3つ（弥生・奉行・JDL）に絞って対応 |
| PDF構造の複雑さ | 中 | パターン学習とテンプレート化 |

### 8.2 スケジュールリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| OCR実装に時間がかかる | 高 | 初期は手入力でもOKとし、OCRは段階的に改善 |
| Excel/PowerPoint生成の複雑さ | 中 | シンプルなフォーマットから開始 |

---

## 9. 用語集

| 用語 | 説明 |
|------|------|
| BS | 貸借対照表（Balance Sheet） |
| PL | 損益計算書（Profit and Loss Statement） |
| 勘定科目内訳書 | 法人税申告時に提出する、勘定科目の詳細内訳 |
| EBITDA | 利払い前・税引き前・減価償却前利益 |
| FCF | フリーキャッシュフロー |
| NetCash/NetDebt | 純現金預金残高 / 純有利子負債残高 |
| OCR | 光学文字認識（Optical Character Recognition） |
| MVP | 最小実用製品（Minimum Viable Product） |

---

## 10. 補足・備考

### 10.1 将来拡張の可能性
- 業界平均値との比較機能
- 時系列トレンド分析（5年、10年）
- 他社比較機能
- より高度なAI分析（倒産リスク予測など）
- レポートのカスタマイズ機能

### 10.2 想定外の対応
- 読み取れないPDFフォーマットが出てきた場合は、手入力で対応
- 計算式が合わない場合は、利用者が計算式をカスタマイズできる機能を検討

---

**以上**
